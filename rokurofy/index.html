<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/af3d4ac3e6.js" crossorigin="anonymous"></script>
    <title>Rokurofy</title>
</head>
<body class="montserrat-normal">
    <header>
        <div>
            <img src="../img/r.svg" alt="Rokurofy logo">
            <span>Rokurofy</span>
        </div>
    </header>

    <!-- Barra lateral izquierda para las listas de reproducción -->
    <aside id="left-sidebar">
        <!-- Aquí puedes agregar el contenido de las listas de reproducción -->
    </aside>

    <main>
        <div id="search">
            <input type="text" id="search-bar" placeholder="Buscar canciones, artistas o álbumes">
            <button id="search-button"><i class="fa-solid fa-search"></i></button>
        </div>
        <div id="results"></div>
    </main>

    <!-- Barra lateral derecha para detalles adicionales de la canción y el artista -->
    <aside id="right-sidebar" class="hideable">
        <!-- Aquí puedes agregar el contenido de los detalles de la canción y el artista -->
    </aside>

    <!-- Sección inferior para los controles del reproductor de música -->
    <footer id="music-player-controls">
        <!-- Aquí puedes agregar los controles del reproductor de música -->
    </footer>
    <script>
        // Define an array to store the playlist data
        let playlists = [];

        // Function to save the playlist in playlists.json using fetch to a flask server running on port 5000 as main.py in python folder
        function createPlaylist(playlistName, playlistImage, playlistDescription, playlistSongs) {
            // Send the playlist data to the server trhough a POST request with URIcomponent
            try {
                fetch('/rokurofy/main.py', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `playlist=${encodeURIComponent(playlistName)}&playlistImage=${encodeURIComponent(playlistImage)}&playlistDescription=${encodeURIComponent(playlistDescription)}&playlistSongs=${encodeURIComponent(JSON.stringify(playlistSongs))}`,
                })
                    .then((response) => response.json())
                    .then((data) => {
                        // Add the playlist to the playlists array
                        playlists.push(data);
                    });
            } catch (error) {
                console.error('Error creating playlist:', error);
            }
        }

        // Function to display the playlists
        function displayPlaylists() {
            const leftSidebar = document.getElementById('left-sidebar');
            leftSidebar.innerHTML = '';

            // get the info of the playlist from the playlists.json file
            fetch('playlists.json')
                .then((response) => response.json())
                .then((data) => {
                    // Asume directamente que data es un array y lo itera
                    data.forEach((playlist) => {
                        console.log(playlist.playlistName);
                        console.log(playlist.playlistImage);
                        // Crea un elemento div para mostrar las playlists en el sidebar izquierdo
                        const leftSidebar = document.getElementById('left-sidebar');
                        const playlistDiv = document.createElement('div');
                        playlistDiv.classList.add('playlist');
                        playlistDiv.style.border = '2px solid deepskyblue';
                        playlistDiv.style.borderRadius = '20px';
                        const playlistImage = document.createElement('img');
                        playlistImage.src = playlist.playlistImage;
                        playlistImage.alt = playlist.playlistId;
                        playlistImage.height = 50;
                        playlistImage.style.display = 'block';
                        playlistImage.style.margin = '0 auto';
                        const playlistName = document.createElement('span');
                        playlistName.textContent = playlist.playlistName;
                        playlistName.style.marginLeft = '10px';
                        playlistName.style.marginBottom = '10px';
                        playlistName.style.display = 'flex';
                        playlistName.style.alignItems = 'center';
                        playlistName.style.justifyContent = 'center';
                        playlistDiv.appendChild(playlistImage);
                        playlistDiv.appendChild(playlistName);
                        playlistDiv.style.margin = '5px';
                        playlistDiv.style.cursor = 'pointer';
                        leftSidebar.appendChild(playlistDiv);
                    });
                })
            }

        displayPlaylists();

        // Function to go to the playlist detail
        //function goToPlaylist: the web is redirected to the playlist detail site, one for each playlist
        function goToPlaylist(playlistName, playlistId) {
            window.location.href = `playlist-detail.html?playlistId=${playlistId}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('left-sidebar').addEventListener('click', (event) => {
                const playlistDiv = event.target.closest('.playlist');
                if (playlistDiv) {
                    const playlistName = playlistDiv.querySelector('span').textContent;
                    const playlistId = playlistDiv.querySelector('img').alt;
                    const playlist = playlists.find((playlist) => playlist.playlistName === playlistName);
                    goToPlaylist(playlistName, playlistId);
                }
            });
        });
    </script>
    <script>
        function createPlaylistGUI() {
            //add a button to create a playlist
            const leftSidebar = document.getElementById('left-sidebar');
            const createPlaylistButton = document.createElement('button');
            createPlaylistButton.textContent = 'Create Playlist';
            createPlaylistButton.style.margin = '10px';
            createPlaylistButton.style.padding = '10px';
            createPlaylistButton.style.border = '1px solid #ccc';
            createPlaylistButton.style.borderRadius = '10px';
            createPlaylistButton.style.cursor = 'pointer';
            createPlaylistButton.addEventListener('click', () => {
                //create a popup form to create a playlist without prompt method
                const main = document.querySelector('main');
                const playlistFormDiv = document.createElement('div');
                playlistFormDiv.id = 'playlist-form';
                const playlistForm = document.createElement('form');
                playlistForm.style.display = 'flex';
                playlistForm.style.flexDirection = 'column';
                playlistForm.style.padding = '10px';
                playlistForm.style.border = '1px solid #ccc';
                playlistForm.style.borderRadius = '10px';
                playlistForm.style.margin = '10px';
                playlistForm.style.width = '200px';
                playlistForm.style.position = 'absolute';
                playlistForm.style.backgroundColor = 'white';
                playlistForm.style.zIndex = '1';
                playlistForm.style.top = '50%';
                playlistForm.style.left = '50%';
                playlistForm.style.transform = 'translate(-50%, -50%)';

                const playlistFormTitle = document.createElement('h2');
                playlistFormTitle.textContent = 'Create Playlist';
                playlistForm.appendChild(playlistFormTitle);

                const playlistNameInput = document.createElement('input');
                playlistNameInput.type = 'text';
                playlistNameInput.placeholder = 'Playlist Name';
                playlistForm.appendChild(playlistNameInput);

                playlistNameInput.style.marginBottom = '10px';

                const playlistDescriptionInput = document.createElement('textarea');
                playlistDescriptionInput.placeholder = 'Playlist Description';
                playlistForm.appendChild(playlistDescriptionInput);

                playlistDescriptionInput.style.marginBottom = '10px';

                //select songs from the stored songs in the 'songs' folder
                const playlistSongsSelect = document.createElement('select');
                playlistSongsSelect.multiple = true;
                playlistSongsSelect.style.marginBottom = '10px';
                //get the songs from the 'songs' folder
                fetch('songs/songs.json')
                    .then((response) => response.json())
                    .then((songs) => {
                        songs.forEach((song) => {
                            const songOption = document.createElement('option');
                            songOption.value = `songs/${song.file}`;
                            songOption.textContent = song.song_name;
                            playlistSongsSelect.appendChild(songOption);
                        });
                    });
                playlistForm.appendChild(playlistSongsSelect);

                const createPlaylistButton = document.createElement('button');
                createPlaylistButton.textContent = 'Create Playlist';
                createPlaylistButton.style.padding = '10px';
                createPlaylistButton.style.border = '1px solid #ccc';
                createPlaylistButton.style.borderRadius = '10px';
                createPlaylistButton.style.cursor = 'pointer';
                createPlaylistButton.style.backgroundColor = 'white';

                playlistForm.appendChild(createPlaylistButton);

                createPlaylistButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    const playlistName = playlistNameInput.value;

                    //get a random image from the playlist_img folder from playlist1.jpeg to playlist4.jpeg
                    const randomImage = Math.floor(Math.random() * 4) + 1;
                    const playlistImage = `playlist_img/playlist${randomImage}.svg`;
                    const playlistDescription = playlistDescriptionInput.value;
                    const playlistSongs = Array.from(playlistSongsSelect.selectedOptions).map((option) => option.value);
                    playlistFormDiv.remove();
                    createPlaylist(playlistName, playlistImage, playlistDescription, playlistSongs);
                    displayPlaylists();
                });

                playlistFormDiv.appendChild(playlistForm);
                main.appendChild(playlistFormDiv);

                createPlaylist(playlistNameInput.value, 'playlist_img/playlist1.svg', playlistDescriptionInput.value, ['songs/edamame.mp3', 'songs/bang.mp3'])
                displayPlaylists();
            });
            leftSidebar.appendChild(createPlaylistButton);

        }
        createPlaylistGUI();
    </script>
    <script>
        function showPlaylistDetail(playlistImage, playlistName, playlistDescription, playlistSongs) {
            const rightSidebar = document.getElementById('right-sidebar');
            rightSidebar.innerHTML = '';

            const playlistImageElement = document.createElement('img');
            playlistImageElement.src = playlistImage; // Cambiado de playlistImage.src a playlistImage
            playlistImageElement.alt = playlistName; // Cambiado de playlistName.textContent a playlistName
            playlistImageElement.width = 100;
            playlistImageElement.style.borderRadius = '10px';
            rightSidebar.appendChild(playlistImageElement);

            const playlistNameElement = document.createElement('h2');
            //check the song name in the songs.json file
            fetch('songs/songs.json')
                .then((response) => response.json())
                .then((songs) => {
                    songs.forEach((song) => {
                        if (playlistSongs.includes(`songs/${song.file}`)) {
                            const songName = song.song_name;
                            playlistNameElement.textContent = songName;
                        }
                    });
                });
            rightSidebar.appendChild(playlistNameElement);

            const playlistDescriptionElement = document.createElement('p');
            playlistDescriptionElement.textContent = playlistDescription;
            rightSidebar.appendChild(playlistDescriptionElement);

            const playlistSongsElement = document.createElement('ul');
            playlistSongs.forEach((song) => {
                const songElement = document.createElement('li');
                songElement.textContent = song;
                playlistSongsElement.appendChild(songElement);
            });
            playlistSongsElement.style.listStyleType = 'none';
            rightSidebar.appendChild(playlistSongsElement);
        }
    </script>
</body>
</html>